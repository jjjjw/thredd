var articles = require('services/articles')
  , commentsSvc = require('services/comments')
  , usersSvc = require('services/users')
  ;

function getArticleData (id) {
  var article
  , comments
  , users
  ;

  return articles.get(id)
  .then(function (results) {
    article = results[0];
    if (!article) {
      var err = new Error('No article found');
      err.status = 404;
      throw err;
      return;
    }
    return commentsSvc.getForArticles(article.id);
  })
  .then(function (results) {
    comments = results;
    return usersSvc.get(comments.map(function (comment) {
      return comment.user;
    }));
  })
  .then(function (results) {
    users = results;
    return {
      article: article
      , comments: comments
      , users: users
    }
  });
};

module.exports = {
  getArticleData: getArticleData
};
