var articles = require('services/articles')
  , comments = require('services/comments')
  , transforms = require('services/transforms')
  , users = require('services/users')
  ;

exports.getArticleData = function (id) {
  var article
  , thread
  , usersObj
  ;

  return articles.get({
    id: id
  })
  .then(function (results) {
    article = results[0];
    if (!article) {
      throw '404';
      return;
    }
    return comments.getForArticles(results);
  })
  .then(function (results) {
    thread = transforms.threadify(results);
    return users.getForComments(results);
  })
  .then(function (results) {
    usersObj = transforms.keyById(results);
    return {
      article: article
      , thread: thread
      , users: usersObj
    }
  });
};
