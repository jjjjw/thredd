var commentsSvc = require('services/comments')
  , Comment = require('ui/thread').Comment
  , fs = require('fs')
  , getUserCommentsData = require('./helpers').getUserCommentsData
  , keyById = require('transforms').keyById
  , Mustache = require('mustache')
  , React = require('react')
  , usersSvc = require('services/users')
  ;

var tmpl = fs.readFileSync(__dirname + '/templates/user-comments.mustache').toString();

module.exports = function (id) {
  return getUserCommentsData(id)
  .then(function (data) {
    var comments = data.comments
      , users = data.users
      ;

    var commentsHtml = '';
    var user = users[0];
    users = keyById(users);
    comments.forEach(function (comment) {
      commentsHtml += React.renderComponentToStaticMarkup(Comment({
        comment: comment
        , depth: 0
        , users: users
      }));
    });

    return Mustache.render(tmpl, {
      commentsHtml: commentsHtml
      , user: user
    });
  });
};
