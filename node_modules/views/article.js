var articles = require('threads/services/articles')
  , fs = require('fs')
  , Mustache = require('mustache')
  , React = require('react')
  , Thread = require('threads/ui/thread').Thread
  , comments = require('threads/services/comments')
  ;

// This is goofiest view ever viewed
var articleTemplate = fs.readFileSync(__dirname + '/templates/article.mustache').toString();

module.exports = function (articleId) {
  var article;
  return articles.get({
    id: articleId
  }).then(function (results) {
    article = results[0];
    return comments.getThread(article);
  }).then(function (thread) {
    return Mustache.render(articleTemplate, {
      body: article.body
      , comments: React.renderComponentToString(Thread({ comments: thread }))
      , title: article.title
    });
  });
};
