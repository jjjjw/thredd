var coll = require('./collections').comments
  , findById = require('./helpers').findById
  , schema = require('./schemas/comment')
  , stringIds = require('./helpers').stringIds
  , transforms = require('./transforms')
  , validateAndSave = require('./helpers').validateAndSave
  ;

exports.get = function (id) {
  return findById(id, coll);
};

exports.getForArticles = function (articleList) {
  var articles = transforms.listify(articleList).map(function (article) {
    return article.id;
  });
  return coll.find({ article: { $in: stringIds(articles, coll) } });
};

exports.post = function (commentList) {
  commentList = transforms.listify(commentList).map(function (comment) {
    comment.createdAt = new Date().getTime();
    return comment;
  });
  return validateAndSave(commentList, schema, coll);
};
