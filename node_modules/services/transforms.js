exports.threadify = function (commentList) {
  var topLevel = []
    , parentMap = {}
    ;

  if (!commentList || !commentList.length) return topLevel;

  commentList = commentList.sort(function(a, b) {
    return a.createdAt - b.createdAt;
  });

  commentList.forEach(function (comment) {
    parentMap[comment.id] = comment;
    var parent = parentMap[comment.parent];
    if (!parent) {
      topLevel.push(comment);
      return;
    }
    if (!parent.thread) parent.thread = [];
    parent.thread.push(comment);
  });

  return topLevel;
};

exports.keyById = function (list) {
  var dict = {};
  list.forEach(function (model) {
    dict[model.id] = model;
  });
  return dict;
};
