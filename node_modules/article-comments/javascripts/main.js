var customEvPolyFill = require('custom-event-polyfill')
  , store = require('./store')
  , view = require('./view')
  ;

function DOMLoaded () {
  var initData = JSON.parse(document.getElementById('js-init-data').getAttribute('data-json'));
  var article = initData.article
    , dataEl = document.getElementById('js-data-msg')
    , comments = initData.comments
    , users = initData.users
    ;

  view.render(article, comments, users);
  store(article, comments, users);

  dataEl.addEventListener('storeUpdated', function (ev) {
    var detail = ev.detail;
    var article = detail.article
      , comments = detail.comments
      , users = detail.users
      ;
    view.render(article, comments, users);
  });
}

module.exports = (function () {
  window.addEventListener('DOMContentLoaded', function () {
    window.removeEventListener('DOMContentLoaded');
    DOMLoaded();
  });
})();
